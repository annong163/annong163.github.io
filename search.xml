<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Springboot深度整合xxl-job</title>
      <link href="/archives/a18695c5.html"/>
      <url>/archives/a18695c5.html</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>XXL-JOB 是一个轻量级分布式任务调度平台，其核心设计目标是开发迅速、学习简单、轻量级、易扩展。现已开放源代码并接入多家公司线上产品线，开箱即用。</p><h2 id="深度整合思路"><a href="#深度整合思路" class="headerlink" title="深度整合思路"></a>深度整合思路</h2><p>内网搭建xxl-job-admin，通过接口形式调取新增、启动、停止、实时日志等方法实现项目内分布式大批量任务调度。</p><h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><p><img src="/img/xxl-%E6%9E%B6%E6%9E%84.png"></p><h2 id="搭建xxl-job-admin"><a href="#搭建xxl-job-admin" class="headerlink" title="搭建xxl-job-admin"></a>搭建xxl-job-admin</h2><h3 id="1-拉取代码"><a href="#1-拉取代码" class="headerlink" title="1.拉取代码"></a>1.拉取代码</h3><p><a href="https://gitee.com/xuxueli0323/xxl-job.git">https://gitee.com/xuxueli0323/xxl-job.git</a></p><h3 id="2-代码结构"><a href="#2-代码结构" class="headerlink" title="2.代码结构"></a>2.代码结构</h3><p><img src="/img/xxl-admin%E7%BB%93%E6%9E%84.png"></p><h3 id="3-运行sql文件"><a href="#3-运行sql文件" class="headerlink" title="3.运行sql文件"></a>3.运行sql文件</h3><p><img src="/img/xxl-sql.png"></p><h3 id="4-修改-xxl-job-admin-模块的-yml-文件"><a href="#4-修改-xxl-job-admin-模块的-yml-文件" class="headerlink" title="4.修改 xxl-job-admin 模块的 yml 文件"></a>4.修改 xxl-job-admin 模块的 yml 文件</h3><p><img src="/img/xxl-yml.png"></p><h3 id="5-启动任务调度中心"><a href="#5-启动任务调度中心" class="headerlink" title="5.启动任务调度中心"></a>5.启动任务调度中心</h3><blockquote><p>账号：admin 密码：123456 （初始状态下）。<br><img src="/img/xxl-login.png"></p></blockquote><h2 id="SpringBoot整合"><a href="#SpringBoot整合" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h2><h3 id="1-引入依赖"><a href="#1-引入依赖" class="headerlink" title="1. 引入依赖"></a>1. 引入依赖</h3><pre class=" language-javascript"><code class="language-javascript">  <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> xxlJob<span class="token operator">-</span>job<span class="token operator">-</span>core <span class="token operator">--</span><span class="token operator">></span>        <span class="token operator">&lt;</span>dependency<span class="token operator">></span>            <span class="token operator">&lt;</span>groupId<span class="token operator">></span>com<span class="token punctuation">.</span>xuxueli<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">></span>            <span class="token operator">&lt;</span>artifactId<span class="token operator">></span>xxl<span class="token operator">-</span>job<span class="token operator">-</span>core<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">></span>            <span class="token operator">&lt;</span>version<span class="token operator">></span><span class="token number">2.3</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token operator">&lt;</span><span class="token operator">/</span>version<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">></span></code></pre><blockquote><p>注意：此处版本要与 xxl-job-admin 中版本保持一致。</p></blockquote><h3 id="2-项目整体引入结构"><a href="#2-项目整体引入结构" class="headerlink" title="2. 项目整体引入结构"></a>2. 项目整体引入结构</h3><p><img src="/img/project.jpg"></p><h3 id="3-新增XxlJobConfig类"><a href="#3-新增XxlJobConfig类" class="headerlink" title="3. 新增XxlJobConfig类"></a>3. 新增XxlJobConfig类</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>executor<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>XxlJobSpringExecutor<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Bean<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Configuration<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * xxlJob-job配置类 * * @author Ma·JJ * @date 2021-07-26 */</span>@Configuration@Slf4j<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxlJobConfig</span> <span class="token punctuation">{</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.admin.addresses}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String adminAddresses<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.accessToken}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String accessToken<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.appname}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String appname<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.address}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String address<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.ip}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String ip<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.port}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> int port<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.logpath}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String logPath<span class="token punctuation">;</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.logretentiondays}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> int logRetentionDays<span class="token punctuation">;</span>    @Bean    <span class="token keyword">public</span> XxlJobSpringExecutor <span class="token function">xxlJobExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">">>>>>>>>>>> xxlJob-job config init."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        XxlJobSpringExecutor xxlJobSpringExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XxlJobSpringExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAdminAddresses</span><span class="token punctuation">(</span>adminAddresses<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAppname</span><span class="token punctuation">(</span>appname<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAddress</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setIp</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setAccessToken</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setLogPath</span><span class="token punctuation">(</span>logPath<span class="token punctuation">)</span><span class="token punctuation">;</span>        xxlJobSpringExecutor<span class="token punctuation">.</span><span class="token function">setLogRetentionDays</span><span class="token punctuation">(</span>logRetentionDays<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> xxlJobSpringExecutor<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="4-修改application-dev-yml"><a href="#4-修改application-dev-yml" class="headerlink" title="4. 修改application-dev.yml"></a>4. 修改application-dev.yml</h3><pre class=" language-javascript"><code class="language-javascript">xxl<span class="token punctuation">:</span>  job<span class="token punctuation">:</span>    accessToken<span class="token punctuation">:</span> Xz$jVwBJvKxcHiaptXW25H6<span class="token operator">^</span><span class="token operator">*</span>HITxu<span class="token operator">!</span>A    jobGroupId<span class="token punctuation">:</span> <span class="token number">5</span>    admin<span class="token punctuation">:</span>      addresses<span class="token punctuation">:</span> http<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">125.74</span><span class="token punctuation">.</span><span class="token number">198.209</span><span class="token punctuation">:</span><span class="token number">8089</span><span class="token operator">/</span>xxl<span class="token operator">-</span>job<span class="token operator">-</span>admin    executor<span class="token punctuation">:</span>      address<span class="token punctuation">:</span> <span class="token string">''</span>      appname<span class="token punctuation">:</span> gkt<span class="token operator">-</span>admin<span class="token operator">-</span>system      ip<span class="token punctuation">:</span> <span class="token string">''</span>      logpath<span class="token punctuation">:</span> <span class="token operator">/</span>data<span class="token operator">/</span>applogs<span class="token operator">/</span>xxl<span class="token operator">-</span>job<span class="token operator">/</span>jobhandler      logretentiondays<span class="token punctuation">:</span> <span class="token number">30</span>      port<span class="token punctuation">:</span> <span class="token number">6666</span>      collectHandler<span class="token punctuation">:</span> collectHandler      exchangeHandler<span class="token punctuation">:</span> exchangeHandler      analyseHandler<span class="token punctuation">:</span> analyseHandler</code></pre><h3 id="5-编写XxlJobController-用于项目前端调取xxl-job调度中心相关接口"><a href="#5-编写XxlJobController-用于项目前端调取xxl-job调度中心相关接口" class="headerlink" title="5. 编写XxlJobController 用于项目前端调取xxl-job调度中心相关接口"></a>5. 编写XxlJobController 用于项目前端调取xxl-job调度中心相关接口</h3><pre class=" language-java"><code class="language-java"><span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>ExecutorBiz<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>model<span class="token punctuation">.</span>LogParam<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>model<span class="token punctuation">.</span>LogResult<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>xxl<span class="token punctuation">.</span>job<span class="token punctuation">.</span>core<span class="token punctuation">.</span>biz<span class="token punctuation">.</span>model<span class="token punctuation">.</span>ReturnT<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>Api<span class="token punctuation">;</span><span class="token keyword">import</span> io<span class="token punctuation">.</span>swagger<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span>ApiOperation<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>api<span class="token punctuation">.</span>vo<span class="token punctuation">.</span>Result<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>xxlJob<span class="token punctuation">.</span>service<span class="token punctuation">.</span>XxlJobService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>*<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 定时任务统一处理中心 * * @author Ma·JJ * @date 2021-07-27 */</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/xxlJob"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Slf4j</span><span class="token annotation punctuation">@Api</span><span class="token punctuation">(</span>tags <span class="token operator">=</span> <span class="token string">"XxlJob接口"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@RestController</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxlJobController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> XxlJobService jobService<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 根据类型执行一次定时任务     *     * @param id     定时任务id     * @param dataId 数据id     * @param type   类型: 1 数据采集 2 数据交换 3 数据分析     * @return Result     */</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/executeByDataId"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">executeByDataId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String id<span class="token punctuation">,</span>    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dataId"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String dataId<span class="token punctuation">,</span>    <span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">executeByDataId</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * 根据类型启动定时任务 * * @param id     定时任务id * @param dataId 数据id * @param type   类型: 1 数据采集 2 数据交换 3 数据分析 * @return Result */</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/resumeByDataId"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"启动定时任务"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Result<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">resumeByDataId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String id<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dataId"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String dataId<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">resumeByDataId</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * 根据类型停止定时任务 * * @param id     定时任务id * @param dataId 数据id * @param type   类型: 1 数据采集 2 数据交换 3 数据分析 * @return Result */</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/pauseByDataId"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"停止定时任务"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Result<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">pauseByDataId</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String id<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dataId"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String dataId<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String type<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"flag"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> String flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">pauseByDataId</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> type<span class="token punctuation">,</span> flag<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/getCurrentLogInfo"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"获取实时日志信息"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">getCurrentLogInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"jobId"</span><span class="token punctuation">)</span> String jobId<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">getCurrentLogInfo</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/logDetailCat"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"获取实时日志详情"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">logDetailCat</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"executorAddress"</span><span class="token punctuation">)</span> String executorAddress<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"triggerTime"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> triggerTime<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"logId"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> logId<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"fromLineNum"</span><span class="token punctuation">)</span> <span class="token keyword">int</span> fromLineNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">logDetailCat</span><span class="token punctuation">(</span>executorAddress<span class="token punctuation">,</span> triggerTime<span class="token punctuation">,</span> logId<span class="token punctuation">,</span> fromLineNum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">/** * 批量同步数据至xxlJob * * @param ids * @return */</span><span class="token annotation punctuation">@ApiOperation</span><span class="token punctuation">(</span><span class="token string">"批量同步数据至xxlJob"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/batchSync"</span><span class="token punctuation">)</span><span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">batchSync</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"ids"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String ids<span class="token punctuation">,</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"type"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> jobService<span class="token punctuation">.</span><span class="token function">batchSync</span><span class="token punctuation">(</span>ids<span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="6-编写XxlJobServiceImpl-用于远程调取xxl-job调度中心接口"><a href="#6-编写XxlJobServiceImpl-用于远程调取xxl-job调度中心接口" class="headerlink" title="6. 编写XxlJobServiceImpl 用于远程调取xxl-job调度中心接口"></a>6. 编写XxlJobServiceImpl 用于远程调取xxl-job调度中心接口</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span><span class="token keyword">import</span> lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span>Slf4j<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>api<span class="token punctuation">.</span>vo<span class="token punctuation">.</span>Result<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>constant<span class="token punctuation">.</span>BusinessConstant<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>constant<span class="token punctuation">.</span>CommonConstant<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>DataAnalyse<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>DataCollect<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>entity<span class="token punctuation">.</span>DataExchange<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span>DataAnalyseService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span>DataCollectService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>system<span class="token punctuation">.</span>service<span class="token punctuation">.</span>DataExchangeService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>xxlJob<span class="token punctuation">.</span>service<span class="token punctuation">.</span>XxlJobService<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>modules<span class="token punctuation">.</span>xxlJob<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>DispatchUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Autowired<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Service<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Arrays<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 定时任务统一处理中心 * * @author Ma·JJ * @date 2021-07-27 */</span>@Service@Slf4j<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XxlJobServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">XxlJobService</span> <span class="token punctuation">{</span>    @Autowired    <span class="token keyword">private</span> DataCollectService dataCollectService<span class="token punctuation">;</span>    @Autowired    <span class="token keyword">private</span> DataExchangeService dataExchangeService<span class="token punctuation">;</span>    @Autowired    <span class="token keyword">private</span> DataAnalyseService dataAnalyseService<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 调度中心@XxlJob名称     */</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.collectHandler}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String collectHandler<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 调度中心@XxlJob名称     */</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.analyseHandler}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String analyseHandler<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 调度中心@XxlJob名称     */</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.executor.exchangeHandler}"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> String exchangeHandler<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 立即执行业务功能     *     * @param jobId  定时任务id     * @param dataId 业务数据id     * @param type   1: 数据采集 2: 数据交换 3 数据分析     * @return Result     */</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">executeByDataId</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">,</span> String dataId<span class="token punctuation">,</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_COLLECT<span class="token punctuation">:</span>                    DataCollect dataCollect <span class="token operator">=</span> dataCollectService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollectService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataCollect<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_EXCHANGE<span class="token punctuation">:</span>                    DataExchange dataExchange <span class="token operator">=</span> dataExchangeService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchangeService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_ANALYSE<span class="token punctuation">:</span>                    DataAnalyse dataAnalyse <span class="token operator">=</span> dataAnalyseService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyseService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataAnalyse<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未匹配到类型"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>jobId<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> BusinessConstant<span class="token punctuation">.</span>JOB_TRIGGER<span class="token punctuation">)</span><span class="token punctuation">;</span>            Integer code <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>            String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CommonConstant<span class="token punctuation">.</span>SC_INTERNAL_SERVER_ERROR_500<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 调度中心出错则更新失败</span>                <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"调度中心出错: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token string">"执行一次成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"执行一次失败: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 根据类型启动定时任务     *     * @param jobId  定时任务id     * @param dataId 数据id     * @param type   类型: 1 数据采集 2 数据交换 3 数据分析     * @return Result     */</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">resumeByDataId</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">,</span> String dataId<span class="token punctuation">,</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_COLLECT<span class="token punctuation">:</span>                    DataCollect dataCollect <span class="token operator">=</span> dataCollectService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollectService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataCollect<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_EXCHANGE<span class="token punctuation">:</span>                    DataExchange dataExchange <span class="token operator">=</span> dataExchangeService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchangeService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_ANALYSE<span class="token punctuation">:</span>                    DataAnalyse dataAnalyse <span class="token operator">=</span> dataAnalyseService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_2<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyseService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataAnalyse<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未匹配到类型"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>jobId<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> BusinessConstant<span class="token punctuation">.</span>JOB_START<span class="token punctuation">)</span><span class="token punctuation">;</span>            Integer code <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>            String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CommonConstant<span class="token punctuation">.</span>SC_INTERNAL_SERVER_ERROR_500<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 调度中心出错则更新失败</span>                <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"调度中心出错: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token string">"启动成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"启动失败: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 根据类型停止定时任务     *     * @param jobId  定时任务id     * @param dataId 数据id     * @param type   类型: 1 数据采集 2 数据交换 3 数据分析     * @param flag   标志: 不为空则立即停止任务     * @return Result     */</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span>Object<span class="token operator">></span> <span class="token function">pauseByDataId</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">,</span> String dataId<span class="token punctuation">,</span> String type<span class="token punctuation">,</span> String flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_COLLECT<span class="token punctuation">:</span>                    DataCollect dataCollect <span class="token operator">=</span> dataCollectService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollectService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataCollect<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_EXCHANGE<span class="token punctuation">:</span>                    DataExchange dataExchange <span class="token operator">=</span> dataExchangeService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchangeService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_ANALYSE<span class="token punctuation">:</span>                    DataAnalyse dataAnalyse <span class="token operator">=</span> dataAnalyseService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setValid</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>VALID_DISABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setExecuteStatus</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>STATUS_1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyseService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataAnalyse<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token keyword">default</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未匹配到类型"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>jobId<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> BusinessConstant<span class="token punctuation">.</span>JOB_STOP<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>flag <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>jobId<span class="token punctuation">,</span> dataId<span class="token punctuation">,</span> BusinessConstant<span class="token punctuation">.</span>JOB_Immed_Stop<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            Integer code <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>            String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>CommonConstant<span class="token punctuation">.</span>SC_INTERNAL_SERVER_ERROR_500<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// 调度中心出错则更新失败</span>                <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"调度中心出错: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token string">"停止成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"停止失败: "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">getCurrentLogInfo</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">getCurrentLogInfo</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        Integer code <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>        String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>CommonConstant<span class="token punctuation">.</span>SC_INTERNAL_SERVER_ERROR_500<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 调度中心出错则更新失败</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"调度中心出错: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span>JSONObject<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 实时日志详情     *     * @param executorAddress     * @param triggerTime     * @param logId     * @param fromLineNum     * @return     */</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">logDetailCat</span><span class="token punctuation">(</span>String executorAddress<span class="token punctuation">,</span> long triggerTime<span class="token punctuation">,</span> long logId<span class="token punctuation">,</span> int fromLineNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">logDetailCat</span><span class="token punctuation">(</span>executorAddress<span class="token punctuation">,</span> triggerTime<span class="token punctuation">,</span> logId<span class="token punctuation">,</span> fromLineNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        Integer code <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CODE<span class="token punctuation">)</span><span class="token punctuation">;</span>        String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>CommonConstant<span class="token punctuation">.</span>SC_INTERNAL_SERVER_ERROR_500<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// 调度中心出错则更新失败</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token string">"调度中心出错: "</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @Override    <span class="token keyword">public</span> Result<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token operator">></span> <span class="token function">batchSync</span><span class="token punctuation">(</span>String ids<span class="token punctuation">,</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>ids<span class="token punctuation">)</span> <span class="token operator">||</span> StringUtils<span class="token punctuation">.</span><span class="token function">isBlank</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ids 及 type 不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        List<span class="token operator">&lt;</span>String<span class="token operator">></span> idList <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>ids<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_COLLECT<span class="token punctuation">:</span>                List<span class="token operator">&lt;</span>DataCollect<span class="token operator">></span> dataCollects <span class="token operator">=</span> dataCollectService<span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>DataCollect dataCollect <span class="token punctuation">:</span> dataCollects<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment" spellcheck="true">// 生成定时任务</span>                    JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">addOrEditTask</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> dataCollect<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            collectHandler<span class="token punctuation">,</span> dataCollect<span class="token punctuation">.</span><span class="token function">getCornString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataCollect<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataCollect<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataCollect<span class="token punctuation">.</span><span class="token function">setQuartzJobId</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>dataCollectService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataCollect<span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"同步成功，任务名称："</span> <span class="token operator">+</span> dataCollect<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，返回内容："</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_EXCHANGE<span class="token punctuation">:</span>                List<span class="token operator">&lt;</span>DataExchange<span class="token operator">></span> dataExchanges <span class="token operator">=</span> dataExchangeService<span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>DataExchange dataExchange <span class="token punctuation">:</span> dataExchanges<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">addOrEditTask</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> dataExchange<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            exchangeHandler<span class="token punctuation">,</span> dataExchange<span class="token punctuation">.</span><span class="token function">getCornString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataExchange<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataExchange<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataExchange<span class="token punctuation">.</span><span class="token function">setQuartzJobId</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>dataExchangeService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataExchange<span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"同步成功，任务名称："</span> <span class="token operator">+</span> dataExchange<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，返回内容："</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>TYPE_ANALYSE<span class="token punctuation">:</span>                List<span class="token operator">&lt;</span>DataAnalyse<span class="token operator">></span> dataAnalyses <span class="token operator">=</span> dataAnalyseService<span class="token punctuation">.</span><span class="token function">listByIds</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span>DataAnalyse dataAnalyse <span class="token punctuation">:</span> dataAnalyses<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    JSONObject jsonObject <span class="token operator">=</span> DispatchUtils<span class="token punctuation">.</span><span class="token function">addOrEditTask</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> dataAnalyse<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            analyseHandler<span class="token punctuation">,</span> dataAnalyse<span class="token punctuation">.</span><span class="token function">getCornString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataAnalyse<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dataAnalyse<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    String content <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>BusinessConstant<span class="token punctuation">.</span>RESULT_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>                    dataAnalyse<span class="token punctuation">.</span><span class="token function">setQuartzJobId</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">this</span><span class="token punctuation">.</span>dataAnalyseService<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>dataAnalyse<span class="token punctuation">)</span><span class="token punctuation">;</span>                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"同步成功，任务名称："</span> <span class="token operator">+</span> dataAnalyse<span class="token punctuation">.</span><span class="token function">getTaskName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"，返回内容："</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"未匹配到类型"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> Result<span class="token punctuation">.</span><span class="token function">OK</span><span class="token punctuation">(</span><span class="token string">"更新成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h3 id="7-远程调取工具类"><a href="#7-远程调取工具类" class="headerlink" title="7.远程调取工具类"></a>7.远程调取工具类</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> cn<span class="token punctuation">.</span>hutool<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpUtil<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSON<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>fastjson<span class="token punctuation">.</span>JSONObject<span class="token punctuation">;</span><span class="token keyword">import</span> com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>collect<span class="token punctuation">.</span>Maps<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>StringUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>SecurityUtils<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>constant<span class="token punctuation">.</span>BusinessConstant<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>jeecg<span class="token punctuation">.</span>common<span class="token punctuation">.</span>system<span class="token punctuation">.</span>vo<span class="token punctuation">.</span>LoginUser<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>Value<span class="token punctuation">;</span><span class="token keyword">import</span> org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span>Component<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Collectors<span class="token punctuation">;</span><span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>stream<span class="token punctuation">.</span>Stream<span class="token punctuation">;</span><span class="token comment" spellcheck="true">/** * 远程调用调度中心 * * @author Ma·JJ * @date 2021-07-27 */</span>@Component<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DispatchUtils</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> String jobAddresses<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> String jobGroup<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">/**     * 调度中心地址     *     * @param addresses     */</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.admin.addresses}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJobAddresses</span><span class="token punctuation">(</span>String addresses<span class="token punctuation">)</span> <span class="token punctuation">{</span>        jobAddresses <span class="token operator">=</span> addresses<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 默认执行器id     *     * @param jobGroupId     */</span>    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${xxl.job.jobGroupId}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJobGroup</span><span class="token punctuation">(</span>String jobGroupId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        jobGroup <span class="token operator">=</span> jobGroupId<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 远程添加/编辑任务(默认BEAN模式)     *     * @param jobId         xxlJobInfo主键     * @param jobName       任务名称     * @param jobHandler    对应执行器中开发的JobHandler类“@JobHandler”注解自定义的value值     * @param scheduleConf  cron表达式     * @param executorParam 执行参数     * @param dataId        采集/分析/交换 id     * @return JSONObject   code:状态码 content 返回信息     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> JSONObject <span class="token function">addOrEditTask</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">,</span> String jobName<span class="token punctuation">,</span> String jobHandler<span class="token punctuation">,</span>                                           String scheduleConf<span class="token punctuation">,</span> String executorParam<span class="token punctuation">,</span> String dataId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        LoginUser sysUser <span class="token operator">=</span> <span class="token punctuation">(</span>LoginUser<span class="token punctuation">)</span> SecurityUtils<span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String url <span class="token operator">=</span> jobAddresses <span class="token operator">+</span> <span class="token string">"/jobinfo/add"</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"addTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            url <span class="token operator">=</span> jobAddresses <span class="token operator">+</span> <span class="token string">"/jobinfo/update"</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"updateTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"addTime"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"jobGroup"</span><span class="token punctuation">,</span> jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"jobDesc"</span><span class="token punctuation">,</span> jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"author"</span><span class="token punctuation">,</span> sysUser<span class="token punctuation">.</span><span class="token function">getRealname</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"alarmEmail"</span><span class="token punctuation">,</span> sysUser<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"scheduleType"</span><span class="token punctuation">,</span> <span class="token string">"CRON"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"scheduleConf"</span><span class="token punctuation">,</span> scheduleConf<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"misfireStrategy"</span><span class="token punctuation">,</span> <span class="token string">"DO_NOTHING"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorRouteStrategy"</span><span class="token punctuation">,</span> <span class="token string">"FIRST"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorHandler"</span><span class="token punctuation">,</span> jobHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorParam"</span><span class="token punctuation">,</span> executorParam<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorBlockStrategy"</span><span class="token punctuation">,</span> <span class="token string">"SERIAL_EXECUTION"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorFailRetryCount"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"glueType"</span><span class="token punctuation">,</span> <span class="token string">"BEAN"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"glueSource"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"glueRemark"</span><span class="token punctuation">,</span> <span class="token string">"GLUE代码初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"glueUpdatetime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"childJobId"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"dataId"</span><span class="token punctuation">,</span> dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>        String out <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 启动、停止、执行一次、删除任务     *     * @param jobId  任务id     * @param dataId 数据id     * @return type 类型  常量>>>BusinessConstant.JOB_     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> JSONObject <span class="token function">execute</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">,</span> String dataId<span class="token punctuation">,</span> String type<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String url <span class="token operator">=</span> jobAddresses <span class="token operator">+</span> <span class="token string">"/jobinfo"</span><span class="token punctuation">;</span>        String result<span class="token punctuation">;</span>        HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> jobId<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_TRIGGER<span class="token punctuation">:</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorParam"</span><span class="token punctuation">,</span> dataId<span class="token punctuation">)</span><span class="token punctuation">;</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/trigger"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_START<span class="token punctuation">:</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/start"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_STOP<span class="token punctuation">:</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/stop"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_REMOVE<span class="token punctuation">:</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/remove"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_REMOVE_BATCH<span class="token punctuation">:</span>                String<span class="token punctuation">[</span><span class="token punctuation">]</span> items <span class="token operator">=</span> jobId<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> ids <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>items<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Integer<span class="token punctuation">:</span><span class="token punctuation">:</span>parseInt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"ids"</span><span class="token punctuation">,</span> ids<span class="token punctuation">)</span><span class="token punctuation">;</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"/removeBatch"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> BusinessConstant<span class="token punctuation">.</span>JOB_Immed_Stop<span class="token punctuation">:</span>                result <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>jobAddresses <span class="token operator">+</span> <span class="token string">"/joblog/killLog"</span><span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">default</span><span class="token punctuation">:</span>                result <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">/**     * 获取实时日志信息     *     * @param jobId 任务id     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> JSONObject <span class="token function">getCurrentLogInfo</span><span class="token punctuation">(</span>String jobId<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String url <span class="token operator">=</span> jobAddresses <span class="token operator">+</span> <span class="token string">"/joblog/getCurrentLogInfo"</span><span class="token punctuation">;</span>        HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"jobId"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>jobId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        String out <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> JSONObject <span class="token function">logDetailCat</span><span class="token punctuation">(</span>String executorAddress<span class="token punctuation">,</span> long triggerTime<span class="token punctuation">,</span> long logId<span class="token punctuation">,</span> int fromLineNum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        String url <span class="token operator">=</span> jobAddresses <span class="token operator">+</span> <span class="token string">"/joblog/logDetailCat"</span><span class="token punctuation">;</span>        HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token operator">></span> map <span class="token operator">=</span> Maps<span class="token punctuation">.</span><span class="token function">newHashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"executorAddress"</span><span class="token punctuation">,</span> executorAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"triggerTime"</span><span class="token punctuation">,</span> triggerTime<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"logId"</span><span class="token punctuation">,</span> logId<span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"fromLineNum"</span><span class="token punctuation">,</span> fromLineNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        String out <span class="token operator">=</span> HttpUtil<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> xxl-job </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxl-job </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql自动化分区</title>
      <link href="/archives/63f7645b.html"/>
      <url>/archives/63f7645b.html</url>
      
        <content type="html"><![CDATA[<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true">#创建自定义存储过程</span><span class="token keyword">DELIMITER</span> <span class="token operator">||</span><span class="token comment" spellcheck="true">-- 删除存储过程</span><span class="token keyword">drop</span> <span class="token keyword">procedure</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> auto_set_partitions <span class="token operator">||</span><span class="token comment" spellcheck="true">-- 必须保证相应数据库表中至少有一个手动分区</span><span class="token comment" spellcheck="true">-- 参数databasename：创建分区的数据库</span><span class="token comment" spellcheck="true">-- 参数tablename：创建分区的表的名称</span><span class="token comment" spellcheck="true">-- 参数partition_number：一次创建多少个分区</span><span class="token comment" spellcheck="true">-- 参数partitiontype：分区类型[0按天分区，1按月分区，2按年分区]</span><span class="token comment" spellcheck="true">-- 参数gaps：分区间隔，如果分区类型为0则表示每个分区的间隔为 gaps天；</span><span class="token comment" spellcheck="true">--       如果分区类型为1则表示每个分区的间隔为 gaps月</span><span class="token comment" spellcheck="true">--            如果分区类型为2则表示每个分区的间隔为 gaps年</span><span class="token keyword">create</span> <span class="token keyword">procedure</span> auto_set_partitions <span class="token punctuation">(</span><span class="token operator">in</span> databasename <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">,</span><span class="token operator">in</span> tablename <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">CHARACTER SET</span> utf8mb4 <span class="token keyword">COLLATE</span> utf8mb4_unicode_ci<span class="token punctuation">,</span> <span class="token operator">in</span> partition_number <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token operator">in</span> partitiontype <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token operator">in</span> gaps <span class="token keyword">int</span><span class="token punctuation">)</span>L_END:<span class="token keyword">begin</span>         <span class="token keyword">declare</span> max_partition_description <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">declare</span> p_name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>           <span class="token keyword">declare</span> p_description <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>       <span class="token keyword">declare</span> isexist_partition <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">declare</span> i <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">-- 查看对应数据库对应表是否已经有手动分区[自动分区前提是必须有手动分区]</span>    <span class="token keyword">select</span> partition_name <span class="token keyword">into</span> isexist_partition <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>partitions <span class="token keyword">where</span> table_schema <span class="token operator">=</span> databasename  <span class="token operator">and</span> table_name <span class="token operator">=</span> tablename <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">-- 如果不存在则打印错误并退出存储过程</span>    <span class="token keyword">if</span> isexist_partition <span class="token operator">&lt;=></span> <span class="token string">""</span> <span class="token keyword">then</span>       <span class="token keyword">select</span> <span class="token string">"partition table not is exist"</span> <span class="token keyword">as</span> <span class="token string">"ERROR"</span><span class="token punctuation">;</span>       leave L_END<span class="token punctuation">;</span>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">-- 获取最大[降序获取]的分区描述[值]</span>    <span class="token keyword">select</span> partition_description <span class="token keyword">into</span> max_partition_description  <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>partitions <span class="token keyword">where</span> table_schema <span class="token operator">=</span> databasename  <span class="token operator">and</span> table_name <span class="token operator">=</span> tablename <span class="token keyword">order</span> <span class="token keyword">by</span> partition_description <span class="token keyword">desc</span> <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">;</span>       <span class="token comment" spellcheck="true">-- 如果最大分区没有,说明没有手动分区,则无法创建自动分区</span>    <span class="token keyword">if</span> max_partition_description <span class="token operator">&lt;=></span> <span class="token string">""</span> <span class="token keyword">then</span>       <span class="token keyword">select</span> <span class="token string">"partition table is error"</span> <span class="token keyword">as</span> <span class="token string">"ERROR"</span><span class="token punctuation">;</span>       leave L_END<span class="token punctuation">;</span>    <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">-- 替换前后的单引号[''两个引号表示一个单引号的转义]</span>    <span class="token comment" spellcheck="true">-- set max_partition_description = REPLACE(max_partition_description, '''', '');</span>     <span class="token comment" spellcheck="true">-- 或使用如下语句</span>     <span class="token keyword">set</span> max_partition_description <span class="token operator">=</span> REPLACE<span class="token punctuation">(</span>max_partition_description<span class="token number">-1</span><span class="token punctuation">,</span> <span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">-- 自动创建number个分区</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> partition_number<span class="token punctuation">)</span> <span class="token keyword">do</span>                 <span class="token keyword">if</span> <span class="token punctuation">(</span>partitiontype <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">then</span>                     <span class="token comment" spellcheck="true">-- 每个分区按天递增,递增gaps天</span>                     <span class="token keyword">set</span> p_description <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>FROM_DAYS<span class="token punctuation">(</span>max_partition_description<span class="token punctuation">)</span><span class="token punctuation">,</span> interval i<span class="token operator">*</span>gaps day<span class="token punctuation">)</span><span class="token punctuation">;</span>                  elseif <span class="token punctuation">(</span>partitiontype <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">then</span>                     <span class="token comment" spellcheck="true">-- 每个分区按月递增,递增gaps月</span>                     <span class="token keyword">set</span> p_description <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>FROM_DAYS<span class="token punctuation">(</span>max_partition_description<span class="token punctuation">)</span><span class="token punctuation">,</span> interval i<span class="token operator">*</span>gaps month<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token keyword">else</span>                      <span class="token comment" spellcheck="true">-- 每个分区按年递增,递增gaps年</span>                     <span class="token keyword">set</span> p_description <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>FROM_DAYS<span class="token punctuation">(</span>max_partition_description<span class="token punctuation">)</span><span class="token punctuation">,</span> interval i<span class="token operator">*</span>gaps year<span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">-- 删除空格</span>                 <span class="token keyword">set</span> p_name <span class="token operator">=</span> REPLACE<span class="token punctuation">(</span>p_description<span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token keyword">set</span> p_description <span class="token operator">=</span> DATE_ADD<span class="token punctuation">(</span>p_description<span class="token punctuation">,</span> interval <span class="token number">1</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token comment" spellcheck="true">-- 如果有横杆替换为空</span>          <span class="token keyword">set</span> p_name <span class="token operator">=</span> REPLACE<span class="token punctuation">(</span>p_name<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">-- 删除时间冒号</span>                 <span class="token keyword">set</span> p_name <span class="token operator">=</span> REPLACE<span class="token punctuation">(</span>p_name<span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">-- alter table tablename add partition ( partition pname values less than ('2017-02-20 10:05:56') );</span>          <span class="token keyword">set</span> <span class="token variable">@sql</span><span class="token operator">=</span>CONCAT<span class="token punctuation">(</span><span class="token string">'ALTER TABLE '</span><span class="token punctuation">,</span> tablename <span class="token punctuation">,</span><span class="token string">' ADD PARTITION ( PARTITION p'</span><span class="token punctuation">,</span> p_name <span class="token punctuation">,</span><span class="token string">' VALUES LESS THAN (TO_DAYS(\''</span><span class="token punctuation">,</span> p_description <span class="token punctuation">,</span><span class="token string">'\')))'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment" spellcheck="true">-- select @sql;</span>          PREPARE stmt <span class="token keyword">from</span> <span class="token variable">@sql</span><span class="token punctuation">;</span>          <span class="token keyword">EXECUTE</span> stmt<span class="token punctuation">;</span>          <span class="token keyword">DEALLOCATE</span> PREPARE stmt<span class="token punctuation">;</span>                 <span class="token comment" spellcheck="true">-- 递增变量</span>          <span class="token keyword">set</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>     <span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span>          <span class="token keyword">end</span> <span class="token operator">||</span><span class="token comment" spellcheck="true">-- 恢复语句中断符</span><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></code></pre><h2 id="创建事件"><a href="#创建事件" class="headerlink" title="创建事件"></a>创建事件</h2><pre class=" language-sql"><code class="language-sql"><span class="token comment" spellcheck="true"># 创建事件</span><span class="token keyword">DELIMITER</span> <span class="token operator">||</span><span class="token keyword">drop</span> event <span class="token keyword">if</span> <span class="token keyword">exists</span> auto_set_partitions  <span class="token operator">||</span><span class="token keyword">create</span> event auto_set_partitions <span class="token keyword">on</span> schedule every <span class="token number">1</span> daystarts <span class="token string">'2021-07-02 15:03:10'</span><span class="token keyword">do</span><span class="token keyword">BEGIN</span>    <span class="token keyword">call</span> auto_set_partitions<span class="token punctuation">(</span><span class="token string">'interface_library'</span><span class="token punctuation">,</span> <span class="token string">'epidemic_report_result'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">END</span> <span class="token operator">||</span><span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> MYSQL存储过程 </tag>
            
            <tag> MYSQL事件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql 各类日期函数的使用</title>
      <link href="/archives/dce3f04e.html"/>
      <url>/archives/dce3f04e.html</url>
      
        <content type="html"><![CDATA[<ul><li><p>今天</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 WHERETO_DAYS<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span> <span class="token operator">=</span>TO_DAYS<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>昨天</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> TO_DAYS<span class="token punctuation">(</span> <span class="token function">NOW</span><span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">-</span> TO_DAYS<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></code></pre></li><li><p>近七天</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> DATE_SUB<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">7</span> DAY<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>本周内</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> YEARWEEK<span class="token punctuation">(</span>DATE_FORMAT<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> YEARWEEK<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>上一周</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> YEARWEEK<span class="token punctuation">(</span>DATE_FORMAT<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">,</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> YEARWEEK<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></code></pre></li><li><p>30天内 注意这个不是本月是从当天起向前推30天</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> DATE_SUB<span class="token punctuation">(</span>CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">30</span> DAY<span class="token punctuation">)</span> <span class="token operator">&lt;=</span><span class="token keyword">DATE</span><span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>本月</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> DATE_FORMAT<span class="token punctuation">(</span> 【时间字段名】<span class="token punctuation">,</span> <span class="token string">'%Y%m'</span> <span class="token punctuation">)</span> <span class="token operator">=</span> DATE_FORMAT<span class="token punctuation">(</span> CURDATE<span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token string">'%Y%m'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>上一个月</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> PERIOD_DIFF<span class="token punctuation">(</span> DATE_FORMAT<span class="token punctuation">(</span> <span class="token function">now</span><span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token string">'%Y%m'</span> <span class="token punctuation">)</span> <span class="token punctuation">,</span> DATE_FORMAT<span class="token punctuation">(</span> 【时间字段名】<span class="token punctuation">,</span> <span class="token string">'%Y%m'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span></code></pre></li><li><p>本季度</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> QUARTER<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token operator">=</span>QUARTER<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>上一季度</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> QUARTER<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token operator">=</span>QUARTER<span class="token punctuation">(</span>DATE_SUB<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>interval <span class="token number">1</span> QUARTER<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>本年度</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 <span class="token keyword">WHERE</span> YEAR<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token operator">=</span>YEAR<span class="token punctuation">(</span><span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li><li><p>上一年度</p><pre class=" language-sql"><code class="language-sql"><span class="token keyword">SELECT</span> 【想要的字段】 <span class="token keyword">FROM</span> 【表名】 WHEREYEAR<span class="token punctuation">(</span>【时间字段名】<span class="token punctuation">)</span><span class="token operator">=</span>YEAR<span class="token punctuation">(</span>date_sub<span class="token punctuation">(</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>interval 1YEAR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></li></ul><blockquote><p>日期函数说明：<br><br>TO_DAYS() 将日期参数返回转换为天，给定一个日期date，返回一个日期号码（自0年以来的天数）。<br>NOW() 函数返回当前的日期和时间。<br>CURDATE() 函数返回当前的日期，是日期不是时间<br>DATE_SUB(current,INTERVAL 【N】 DAY) 将current向前推 N天<br>DATE_ADD(current,INTERVAL 【N】 DAY) 将current向后推 N天<br>YEARWEEK 是获取年份和周数的一个函数，函数形式为 YEARWEEK(date[,mode])<br>DATE_FORMAT( article_last_update, ‘%Y%m’ ) 按照格式 格式化时间字符串<br>QUARTER(date) 返回日期的一年中的季度，范围为1到4。<br>YEAR(date) 返回日期的年份，范围为1000到9999，或者对于“零”日期返回0。<br>MONTH(date) 返回日期的月份，1月至12月的范围为1至12，对于包含月份为零的日期（如“0000-00-00”或“2008-00-00”），返回0。<br>WEEK(date[,mode]) 此函数返回日期的周号。 WEEK()的双参数使您能够指定星期是从星期天还是星期一开始，以及返回值是在0到53还是从1到53的范围内。如果省略mode参数，则值 使用了default_week_format系统变量。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>java自定义编号生成</title>
      <link href="/archives/49d3b2db.html"/>
      <url>/archives/49d3b2db.html</url>
      
        <content type="html"><![CDATA[<h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>工作中要求合同编号自动生成 格式 NYZL-001，NYZL-002。。。在我的StringUtils工具类中新增如下方法，该方法可以自定义前缀以及当前排到数字几了（可从数据库中查询最大的编号+1）</p><h2 id="方法一：自定义前缀代码"><a href="#方法一：自定义前缀代码" class="headerlink" title="方法一：自定义前缀代码"></a>方法一：自定义前缀代码</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**     * 自动生成编号     * @param prefix  前缀，往往是一串字符串     * @param nowNum  当前要生成的数字     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> synchronized String <span class="token function">getConteactNo</span><span class="token punctuation">(</span>String prefix<span class="token punctuation">,</span>int nowNum <span class="token punctuation">)</span> <span class="token punctuation">{</span>        StringBuilder builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        StringBuilder num <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        AtomicInteger count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span>nowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 4位数字的采取编号处理。9999的情况下从001开始采取。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">9999</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 采用4位数的数字进行序号处理。</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// num.append("00").append(count.getAndIncrement());</span>            num<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"00"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// num.append(count.getAndIncrement());</span>            num<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            num<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">getAndIncrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// 组合。</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>prefix<span class="token punctuation">)</span><span class="token punctuation">;</span>        builder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> builder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><blockquote><p>incrementAndGet   返回加1后的新值<br/><br>getAndIncrement   返回旧值（即加1前的原始值)</p></blockquote><h2 id="方法二：自动递增返回位数字符串"><a href="#方法二：自动递增返回位数字符串" class="headerlink" title="方法二：自动递增返回位数字符串"></a>方法二：自动递增返回位数字符串</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicNumUtils</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">/**     * 递增生成 0000001 格式 线程安全     *     * @param nowNum  当前数值     * @param miniMum 生成的最小位数(自动补零)     * @return 返回值 = 当前值 + 1     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> synchronized String <span class="token function">getSn</span><span class="token punctuation">(</span>Integer nowNum<span class="token punctuation">,</span> Integer miniMum<span class="token punctuation">)</span> <span class="token punctuation">{</span>        NumberFormat formatter <span class="token operator">=</span> NumberFormat<span class="token punctuation">.</span><span class="token function">getNumberInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// 整数显示最少位数不足前面补零</span>        formatter<span class="token punctuation">.</span><span class="token function">setMinimumIntegerDigits</span><span class="token punctuation">(</span>miniMum<span class="token punctuation">)</span><span class="token punctuation">;</span>        formatter<span class="token punctuation">.</span><span class="token function">setGroupingUsed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        AtomicInteger count <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span>nowNum<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> formatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>count<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具类 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue将页面导出为Excel</title>
      <link href="/archives/a345773a.html"/>
      <url>/archives/a345773a.html</url>
      
        <content type="html"><![CDATA[<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>整合jquery插件table2excel.js ，并且修改部分源码支持自定义文件名、自定义sheet工作表名称、表格自动添加边框。</p><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>项目中有许多报表之类的统计 涉及表格跨行跨列较多故无法使用xlsx导出（因为需要一行一行处理跨行跨列），所以在Vue中整合了 jquery插件table2excel.js ，并且修改了部分源码支持自定义文件名、自定义sheet工作表名称、表格自动添加边框。</p><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/img/%E5%AF%BC%E5%87%BA%E4%B8%BAexcel1.png"><br><img src="/img/%E5%AF%BC%E5%87%BA%E4%B8%BAexcel2.png"></p><h2 id="详细步骤"><a href="#详细步骤" class="headerlink" title="详细步骤"></a>详细步骤</h2><h3 id="1-首先需要在Vue中引入jquery"><a href="#1-首先需要在Vue中引入jquery" class="headerlink" title="1.首先需要在Vue中引入jquery"></a>1.首先需要在Vue中引入jquery</h3><pre class=" language-javascript"><code class="language-javascript"> npm install jquery</code></pre><h3 id="2-将下载好的table2excel放到项目中-比如我们用的antd脚手架直接放到util下-下载链接在文末"><a href="#2-将下载好的table2excel放到项目中-比如我们用的antd脚手架直接放到util下-下载链接在文末" class="headerlink" title="2.将下载好的table2excel放到项目中 比如我们用的antd脚手架直接放到util下(下载链接在文末)"></a>2.将下载好的table2excel放到项目中 比如我们用的antd脚手架直接放到util下(下载链接在文末)</h3><p><img src="/img/%E5%AF%BC%E5%87%BA%E4%B8%BAexcel3.png"></p><h3 id="3-修改table2excel源码，在第一行引入Vue中的jquery-（最新文件已设置完毕，可忽略）"><a href="#3-修改table2excel源码，在第一行引入Vue中的jquery-（最新文件已设置完毕，可忽略）" class="headerlink" title="3.修改table2excel源码，在第一行引入Vue中的jquery （最新文件已设置完毕，可忽略）"></a>3.修改table2excel源码，在第一行引入Vue中的jquery （最新文件已设置完毕，可忽略）</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> jQuery <span class="token keyword">from</span> <span class="token string">'jquery'</span></code></pre><h3 id="4-在项目入口main-js中引入"><a href="#4-在项目入口main-js中引入" class="headerlink" title="4.在项目入口main.js中引入"></a>4.在项目入口main.js中引入</h3><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> <span class="token string">'./utils/table2excel'</span> <span class="token comment" spellcheck="true">// global table2excel</span></code></pre><h3 id="5-在demo-vue中使用table2excel"><a href="#5-在demo-vue中使用table2excel" class="headerlink" title="5.在demo.vue中使用table2excel"></a>5.在demo.vue中使用table2excel</h3><h4 id="5-1-引入jquery"><a href="#5-1-引入jquery" class="headerlink" title="5.1 引入jquery"></a>5.1 引入jquery</h4><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span></code></pre><h4 id="5-2-table中加入id"><a href="#5-2-table中加入id" class="headerlink" title="5.2 table中加入id"></a>5.2 table中加入id</h4><p><img src="/img/%E5%AF%BC%E5%87%BA%E4%B8%BAexcel4.png"></p><h4 id="5-3-在methods方法中使用"><a href="#5-3-在methods方法中使用" class="headerlink" title="5.3 在methods方法中使用"></a>5.3 在methods方法中使用</h4><pre class=" language-javascript"><code class="language-javascript">methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>    <span class="token function">exportExcel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"#aTable"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">table2excel</span><span class="token punctuation">(</span><span class="token punctuation">{</span>         exclude<span class="token punctuation">:</span> <span class="token string">".noExl"</span><span class="token punctuation">,</span>         sheetName<span class="token punctuation">:</span> <span class="token string">"八项数据管控"</span><span class="token punctuation">,</span>         filename<span class="token punctuation">:</span> <span class="token string">"八项数据管控"</span><span class="token punctuation">,</span>         exclude_img<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>         exclude_links<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>         exclude_inputs<span class="token punctuation">:</span> <span class="token boolean">true</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="下载链接"><a href="#下载链接" class="headerlink" title="下载链接"></a>下载链接</h2><p><a href="https://annong.lanzous.com/iDU8jnarhah">https://annong.lanzous.com/iDU8jnarhah</a></p>]]></content>
      
      
      <categories>
          
          <category> VUE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VUE组件 </tag>
            
            <tag> Ant Design Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vue在线接口调试组件</title>
      <link href="/archives/2752da05.html"/>
      <url>/archives/2752da05.html</url>
      
        <content type="html"><![CDATA[<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/img/%E5%9C%A8%E7%BA%BF%E8%B0%83%E8%AF%95%E7%BB%84%E4%BB%B6.png"></p><h2 id="组件-InterfaceTest-vue"><a href="#组件-InterfaceTest-vue" class="headerlink" title="组件: InterfaceTest.vue"></a>组件: InterfaceTest.vue</h2><pre class=" language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span>template<span class="token operator">></span>  <span class="token operator">&lt;</span>a<span class="token operator">-</span>drawer    title<span class="token operator">=</span><span class="token string">"在线接口测试"</span>    width<span class="token operator">=</span><span class="token string">"60%"</span>    placement<span class="token operator">=</span><span class="token string">"right"</span>    @close<span class="token operator">=</span><span class="token string">"close"</span>    <span class="token punctuation">:</span>destroy<span class="token operator">-</span>on<span class="token operator">-</span>close<span class="token operator">=</span><span class="token string">"true"</span>    <span class="token punctuation">:</span>visible<span class="token operator">=</span><span class="token string">"visible"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>a<span class="token operator">-</span>card <span class="token punctuation">:</span>bordered<span class="token operator">=</span><span class="token string">"false"</span><span class="token operator">></span>      <span class="token operator">&lt;</span>a<span class="token operator">-</span>row style<span class="token operator">=</span><span class="token string">"margin-top: 20px"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>col <span class="token punctuation">:</span>md<span class="token operator">=</span><span class="token string">"2"</span> <span class="token punctuation">:</span>sm<span class="token operator">=</span><span class="token string">"4"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>a<span class="token operator">-</span>select style<span class="token operator">=</span><span class="token string">"width: 90px"</span> size<span class="token operator">=</span><span class="token string">"large"</span> <span class="token keyword">default</span><span class="token operator">-</span>value<span class="token operator">=</span><span class="token string">"GET"</span> disabled<span class="token operator">></span>            <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">"GET"</span><span class="token operator">></span>GET<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option<span class="token operator">></span>          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>col<span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>col <span class="token punctuation">:</span>md<span class="token operator">=</span><span class="token string">"22"</span> <span class="token punctuation">:</span>sm<span class="token operator">=</span><span class="token string">"20"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>a<span class="token operator">-</span>input<span class="token operator">-</span>search            placeholder<span class="token operator">=</span><span class="token string">"input send url"</span>            v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"tokenUrl"</span>            <span class="token punctuation">:</span>expand<span class="token operator">-</span>depth<span class="token operator">=</span><span class="token string">"5"</span>            @search<span class="token operator">=</span><span class="token string">"onSearch"</span>            enterButton<span class="token operator">=</span><span class="token string">"获 取 token"</span>            size<span class="token operator">=</span><span class="token string">"large"</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>col<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>row<span class="token operator">></span>      <span class="token operator">&lt;</span>a<span class="token operator">-</span>row style<span class="token operator">=</span><span class="token string">"margin-top: 20px"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>col <span class="token punctuation">:</span>md<span class="token operator">=</span><span class="token string">"2"</span> <span class="token punctuation">:</span>sm<span class="token operator">=</span><span class="token string">"4"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>a<span class="token operator">-</span>select style<span class="token operator">=</span><span class="token string">"width: 90px"</span> v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"requestMethod"</span> size<span class="token operator">=</span><span class="token string">"large"</span><span class="token operator">></span>            <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">"GET"</span><span class="token operator">></span>GET<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option<span class="token operator">></span>            <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">"POST"</span><span class="token operator">></span>POST<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option<span class="token operator">></span>            <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">"PUT"</span><span class="token operator">></span>PUT<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option<span class="token operator">></span>            <span class="token operator">&lt;</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option value<span class="token operator">=</span><span class="token string">"DELETE"</span><span class="token operator">></span>DELETE<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">-</span>option<span class="token operator">></span>          <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>select<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>col<span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>col <span class="token punctuation">:</span>md<span class="token operator">=</span><span class="token string">"22"</span> <span class="token punctuation">:</span>sm<span class="token operator">=</span><span class="token string">"20"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>a<span class="token operator">-</span>input<span class="token operator">-</span>search            placeholder<span class="token operator">=</span><span class="token string">"input send url"</span>            v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"url"</span>            <span class="token punctuation">:</span>expand<span class="token operator">-</span>depth<span class="token operator">=</span><span class="token string">"5"</span>            @search<span class="token operator">=</span><span class="token string">"onSearch"</span>            enterButton<span class="token operator">=</span><span class="token string">"发 送 请 求"</span>            size<span class="token operator">=</span><span class="token string">"large"</span> <span class="token operator">/</span><span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>col<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>row<span class="token operator">></span>      <span class="token operator">&lt;</span>a<span class="token operator">-</span>tabs defaultActiveKey<span class="token operator">=</span><span class="token string">"2"</span> style<span class="token operator">=</span><span class="token string">"margin-top: 10px"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>tab<span class="token operator">-</span>pane tab<span class="token operator">=</span><span class="token string">"Params"</span> key<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>a<span class="token operator">-</span>textarea style<span class="token operator">=</span><span class="token string">"width:100%;font-size: 16px;font-weight:500;height: 300px;resize: none;"</span> @blur<span class="token operator">=</span><span class="token string">"changeVal"</span> <span class="token punctuation">:</span>placeholder<span class="token operator">=</span><span class="token string">"paramsPlace"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>textarea<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tab<span class="token operator">-</span>pane<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tabs<span class="token operator">></span>      <span class="token operator">&lt;</span>a<span class="token operator">-</span>tabs defaultActiveKey<span class="token operator">=</span><span class="token string">"1"</span> style<span class="token operator">=</span><span class="token string">"margin-top: 10px"</span><span class="token operator">></span>        <span class="token operator">&lt;</span>a<span class="token operator">-</span>tab<span class="token operator">-</span>pane tab<span class="token operator">=</span><span class="token string">"Response"</span> key<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">></span>          <span class="token operator">&lt;</span>json<span class="token operator">-</span>viewer            style<span class="token operator">=</span><span class="token string">"background-color: #E9EBFE;min-height: 300px;"</span>            <span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string">"resultJson"</span>            boxed<span class="token operator">></span>          <span class="token operator">&lt;</span><span class="token operator">/</span>json<span class="token operator">-</span>viewer<span class="token operator">></span>        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tab<span class="token operator">-</span>pane<span class="token operator">></span>      <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>tabs<span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>card<span class="token operator">></span>  <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">-</span>drawer<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>  <span class="token keyword">import</span> <span class="token punctuation">{</span> axios <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@/utils/request'</span>  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>    name<span class="token punctuation">:</span> <span class="token string">'FlowTest'</span><span class="token punctuation">,</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> <span class="token punctuation">{</span>        url<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        tokenStr<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        tokenUrl<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>        paramJson<span class="token punctuation">:</span> <span class="token string">'参数转换后对应的JSON'</span><span class="token punctuation">,</span>        paramsPlace<span class="token punctuation">:</span> <span class="token string">'{\n“key1” : “value1”,\n“key2” : value2\n}'</span><span class="token punctuation">,</span>        visible<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>        resultJson<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        requestMethod<span class="token punctuation">:</span> <span class="token string">'GET'</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>      <span class="token function">show</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>url <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>VUE_APP_API_BASE_URL <span class="token operator">+</span> record<span class="token punctuation">.</span>address        <span class="token keyword">this</span><span class="token punctuation">.</span>tokenUrl <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>VUE_APP_API_BASE_URL <span class="token operator">+</span> <span class="token string">'/openApi/refreshToken/'</span> <span class="token operator">+</span> record<span class="token punctuation">.</span>appId <span class="token operator">+</span> <span class="token string">'/lzjy@2021!'</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>requestMethod <span class="token operator">=</span> record<span class="token punctuation">.</span>method_dictText        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">true</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      onSearch <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>          that<span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请填写路径'</span><span class="token punctuation">)</span>          <span class="token keyword">return</span> <span class="token boolean">false</span>        <span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>resultJson <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>tokenStr<span class="token punctuation">)</span>        <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>              <span class="token string">'Access-Token'</span><span class="token punctuation">:</span> that<span class="token punctuation">.</span>tokenStr            <span class="token punctuation">}</span><span class="token punctuation">,</span>            url<span class="token punctuation">:</span> value<span class="token punctuation">,</span>            method<span class="token punctuation">:</span> that<span class="token punctuation">.</span>requestMethod<span class="token punctuation">,</span>            data<span class="token punctuation">:</span> that<span class="token punctuation">.</span>paramJson<span class="token punctuation">,</span>            params<span class="token punctuation">:</span> that<span class="token punctuation">.</span>paramJson          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            that<span class="token punctuation">.</span>resultJson <span class="token operator">=</span> res            <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'refreshToken'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              that<span class="token punctuation">.</span>tokenStr <span class="token operator">=</span> res<span class="token punctuation">.</span>result              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'***********'</span> <span class="token operator">+</span> that<span class="token punctuation">.</span>tokenStr<span class="token punctuation">)</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>            that<span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'请求异常：'</span> <span class="token operator">+</span> err<span class="token punctuation">)</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token function">changeVal</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>          <span class="token keyword">let</span> json <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>json<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token boolean">false</span>          <span class="token punctuation">}</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>paramJson <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>          <span class="token keyword">this</span><span class="token punctuation">.</span>$message<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'非法的JSON字符串'</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      close <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>resultJson <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>paramJson <span class="token operator">=</span> <span class="token string">''</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>visible <span class="token operator">=</span> <span class="token boolean">false</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> VUE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VUE组件 </tag>
            
            <tag> Ant Design Vue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mysql分组统计最近七天数据，无则补零</title>
      <link href="/archives/92d5164f.html"/>
      <url>/archives/92d5164f.html</url>
      
        <content type="html"><![CDATA[<pre class=" language-java"><code class="language-java">SELECT  <span class="token function">DATE_FORMAT</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>timeDay<span class="token punctuation">,</span> <span class="token string">'%m-%d'</span><span class="token punctuation">)</span> AS time<span class="token punctuation">,</span>  <span class="token function">IFNULL</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>success<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> AS success<span class="token punctuation">,</span>  <span class="token function">IFNULL</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>fail<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> AS fail<span class="token function">FROM</span>  <span class="token punctuation">(</span>    SELECT      <span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">1</span> DAY<span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">2</span> DAY<span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">3</span> DAY<span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">4</span> DAY<span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">5</span> DAY<span class="token punctuation">)</span> AS timeDay    UNION ALL    SELECT      <span class="token function">date_sub</span><span class="token punctuation">(</span><span class="token function">curdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> INTERVAL <span class="token number">6</span> DAY<span class="token punctuation">)</span> AS timeDay  <span class="token punctuation">)</span> a  LEFT <span class="token function">JOIN</span> <span class="token punctuation">(</span>    SELECT      <span class="token function">date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>last_execute_date<span class="token punctuation">)</span> AS time<span class="token punctuation">,</span>      <span class="token function">sum</span><span class="token punctuation">(</span>        CASE          WHEN d<span class="token punctuation">.</span>execute_status <span class="token operator">=</span> <span class="token string">'3'</span> THEN <span class="token number">1</span>          ELSE <span class="token number">0</span>        END      <span class="token punctuation">)</span> AS success<span class="token punctuation">,</span>      <span class="token function">sum</span><span class="token punctuation">(</span>        CASE          WHEN d<span class="token punctuation">.</span>execute_status <span class="token operator">=</span> <span class="token string">'4'</span> THEN <span class="token number">1</span>          ELSE <span class="token number">0</span>        END      <span class="token punctuation">)</span> AS fail    FROM      data_collect d    GROUP BY      <span class="token function">date</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>last_execute_date<span class="token punctuation">)</span>  <span class="token punctuation">)</span> b ON a<span class="token punctuation">.</span>timeDay <span class="token operator">=</span> b<span class="token punctuation">.</span>timeORDER BY  time</code></pre>]]></content>
      
      
      <categories>
          
          <category> MYSQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
            <tag> MYSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JDK8—Stream集合操作快速上手</title>
      <link href="/archives/a20afd81.html"/>
      <url>/archives/a20afd81.html</url>
      
        <content type="html"><![CDATA[<h2 id="Stream简介"><a href="#Stream简介" class="headerlink" title="Stream简介"></a>Stream简介</h2><ul><li>Java 8引入了全新的Stream API。这里的Stream和I/O流不同，它更像具有Iterable的集合类，但行为和集合类又有所不同。</li><li>stream是对集合对象功能的增强，它专注于对集合对象进行各种非常便利、高效的聚合操作，或者大批量数据操作。</li><li>只要给出需要对其包含的元素执行什么操作，比如 “过滤掉长度大于 10 的字符串”、“获取每个字符串的首字母”等，Stream 会隐式地在内部进行遍历，做出相应的数据转换。</li></ul><h2 id="为什么要使用Stream"><a href="#为什么要使用Stream" class="headerlink" title="为什么要使用Stream"></a>为什么要使用Stream</h2><ul><li>函数式编程带来的好处尤为明显。这种代码更多地表达了业务逻辑的意图，而不是它的实现机制。易读的代码也易于维护、更可靠、更不容易出错。</li><li>高端 (▼へ▼メ)</li></ul><h2 id="实例数据源"><a href="#实例数据源" class="headerlink" title="实例数据源"></a>实例数据源</h2><pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Data</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> list <span class="token operator">=</span> null<span class="token punctuation">;</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        PersonModel wu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token string">"wu qi"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PersonModel zhang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token string">"zhang san"</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PersonModel wang <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token string">"wang si"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"女"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PersonModel zhao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token string">"zhao wu"</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        PersonModel chen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token string">"chen liu"</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token string">"男"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        list <span class="token operator">=</span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>wu<span class="token punctuation">,</span> zhang<span class="token punctuation">,</span> wang<span class="token punctuation">,</span> zhao<span class="token punctuation">,</span> chen<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><h2 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h2><ul><li><p>遍历数据并检查其中的元素时使用。</p></li><li><p>filter接受一个函数作为参数，该函数用Lambda表达式表示。</p><pre class=" language-java"><code class="language-java">  <span class="token comment" spellcheck="true">/**   * 过滤所有的男性   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fiterSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//old</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> temp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>PersonModel person<span class="token operator">:</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              temp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//new</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> collect <span class="token operator">=</span> data              <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>person <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 过滤所有的男性 并且小于20岁   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">fiterSexAndAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//old</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> temp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>PersonModel person<span class="token operator">:</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>              temp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      <span class="token comment" spellcheck="true">//new 1</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> collect <span class="token operator">=</span> data              <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>person <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                  <span class="token punctuation">}</span>                  <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//new 2</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> collect1 <span class="token operator">=</span> data              <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>person <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span><span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><ul><li><p>map生成的是个一对一映射,for的作用</p><pre class=" language-javascript"><code class="language-javascript"> <span class="token comment" spellcheck="true">/**   * 取出所有的用户名字   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getUserNameList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//old</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> list<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>PersonModel persion<span class="token punctuation">:</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>          list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>persion<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//new 1</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>person <span class="token operator">-</span><span class="token operator">></span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//new 2</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect1 <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//new 3</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect2 <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>person <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul><h2 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h2><ul><li><p>感觉类似递归</p></li><li><p>数字(字符串)累加</p><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reduceTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token comment" spellcheck="true">//累加，初始化值是 10</span>      Integer reduce <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>count<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"count:"</span><span class="token operator">+</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>          System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"item:"</span><span class="token operator">+</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> count <span class="token operator">+</span> item<span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reduce<span class="token punctuation">)</span><span class="token punctuation">;</span>      Integer reduce1 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reduce1<span class="token punctuation">)</span><span class="token punctuation">;</span>      String reduce2 <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token string">","</span> <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>reduce2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul><h2 id="Collect"><a href="#Collect" class="headerlink" title="Collect"></a>Collect</h2><ul><li><p>collect在流中生成列表，map，等常用的数据结构</p></li><li><p>toList()</p></li><li><p>toSet()</p></li><li><p>toMap()</p></li><li><p>自定义</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">/**   * toList   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toListTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * toSet   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toSetTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      Set<span class="token operator">&lt;</span>String<span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * toMap   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>                      Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">,</span> PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getAge<span class="token punctuation">)</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>      data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span>per<span class="token operator">-</span><span class="token operator">></span>per<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>          <span class="token keyword">return</span> value<span class="token operator">+</span><span class="token string">"1"</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 指定类型   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toTreeSetTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      TreeSet<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span>TreeSet<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 分组   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toGroupTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      Map<span class="token operator">&lt;</span>Boolean<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span><span class="token operator">></span> collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span>per <span class="token operator">-</span><span class="token operator">></span> <span class="token string">"男"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>per<span class="token punctuation">.</span><span class="token function">getSex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 分隔   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">toJoiningTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> data <span class="token operator">=</span> Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      String collect <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>personModel <span class="token operator">-</span><span class="token operator">></span> personModel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>              <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">,</span> <span class="token string">"{"</span><span class="token punctuation">,</span> <span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 自定义   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>String<span class="token operator">></span> collect <span class="token operator">=</span> Stream<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>              Collectors<span class="token punctuation">.</span><span class="token function">reducing</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x <span class="token operator">-</span><span class="token operator">></span> Arrays<span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>y<span class="token punctuation">,</span> z<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token punctuation">{</span>                  y<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token keyword">return</span> y<span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>collect<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul><h2 id="Optional"><a href="#Optional" class="headerlink" title="Optional"></a>Optional</h2><ul><li>Optional 是为核心类库新设计的一个数据类型，用来替换 null 值。</li><li>人们对原有的 null 值有很多抱怨，甚至连发明这一概念的Tony Hoare也是如此，他曾说这是自己的一个“价值连城的错误”</li><li>用处很广，不光在lambda中，哪都能用</li><li>Optional.of(T)，T为非空，否则初始化报错</li><li>Optional.ofNullable(T)，T为任意，可以为空</li><li>isPresent()，相当于 ！=null</li><li>ifPresent(T)， T可以是一段lambda表达式 ，或者其他代码，非空则执行</li></ul><pre class=" language-javascript"><code class="language-javascript"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        PersonModel personModel<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">PersonModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//对象为空则打出 -</span>        Optional<span class="token operator">&lt;</span>Object<span class="token operator">></span> o <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token keyword">of</span><span class="token punctuation">(</span>personModel<span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>o<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//名称为空则打出 -</span>        Optional<span class="token operator">&lt;</span>String<span class="token operator">></span> name <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>personModel<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span>name<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//如果不为空，则打出xxx</span>        Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>na<span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>na<span class="token operator">+</span><span class="token string">"ifPresent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//如果空，则返回指定字符串</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//如果空，则返回 指定方法，或者代码</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"hahah"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token string">"hahah"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//如果空，则可以抛出异常</span>        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//        Objects.requireNonNull(null,"is null");</span>        <span class="token comment" spellcheck="true">//利用 Optional 进行多级判断</span>        EarthModel earthModel1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EarthModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//old</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>earthModel1<span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>earthModel1<span class="token punctuation">.</span><span class="token function">getTea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">//...</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">//new</span>        Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>earthModel1<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>EarthModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getTea<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>TeaModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getType<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//        Optional&lt;EarthModel> earthModel = Optional.ofNullable(new EarthModel());</span><span class="token comment" spellcheck="true">//        Optional&lt;List&lt;PersonModel>> personModels = earthModel.map(EarthModel::getPersonModels);</span><span class="token comment" spellcheck="true">//        Optional&lt;Stream&lt;String>> stringStream = personModels.map(per -> per.stream().map(PersonModel::getName));</span>        <span class="token comment" spellcheck="true">//判断对象中的list</span>        Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EarthModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>EarthModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getPersonModels<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>pers<span class="token operator">-</span><span class="token operator">></span>pers                        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>per<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        List<span class="token operator">&lt;</span>PersonModel<span class="token operator">></span> models<span class="token operator">=</span>Data<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>models<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>per <span class="token operator">-</span><span class="token operator">></span> per                        <span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>PersonModel<span class="token punctuation">:</span><span class="token punctuation">:</span>getName<span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span>per<span class="token operator">-</span><span class="token operator">></span> System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>per<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span></code></pre><h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h2><ul><li><p>stream替换成parallelStream或 parallel</p></li><li><p>输入流的大小并不是决定并行化是否会带来速度提升的唯一因素，性能还会受到编写代码的方式和核的数量的影响</p></li><li><p>影响性能的五要素是:数据大小、源数据结构、值是否装箱、可用的CPU核数量，以及处理每个元素所花的时间</p><pre class=" language-javascript"><code class="language-javascript"><span class="token comment" spellcheck="true">//根据数字的大小，有不同的结果</span>  <span class="token keyword">private</span> <span class="token keyword">static</span> int size<span class="token operator">=</span><span class="token number">10000000</span><span class="token punctuation">;</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------List-----------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------Set-----------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 测试list   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>Integer i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> temp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//老的</span>      long start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>Integer i<span class="token punctuation">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>          temp1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">+</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//同步</span>      long start1<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//并发</span>      long start2<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">/**   * 测试set   */</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      List<span class="token operator">&lt;</span>Integer<span class="token operator">></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>Integer i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Integer</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      Set<span class="token operator">&lt;</span>Integer<span class="token operator">></span> temp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token operator">&lt;</span><span class="token operator">></span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//老的</span>      long start<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">for</span> <span class="token punctuation">(</span>Integer i<span class="token punctuation">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>          temp1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token operator">+</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//同步</span>      long start1<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start1<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//并发</span>      long start2<span class="token operator">=</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      list<span class="token punctuation">.</span><span class="token function">parallelStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>start2<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span></code></pre></li></ul>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JDK8 </tag>
            
            <tag> 集合 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
